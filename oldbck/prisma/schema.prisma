// ============================================
// PRISMA SCHEMA
// ============================================
// After changes, run:
//   npm run db:generate   (regenerate Prisma client)
//   npm run db:migrate    (create migration)
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum Role {
  SELLER
  BUYER
}

// ============================================
// Authentication & Registration Models
// ============================================

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  name          String
  businessName  String
  phone         String
  role          Role     @default(BUYER)
  emailVerified Boolean  @default(false)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  sessions                Session[]
  passwordResetTokens     PasswordResetToken[]
  emailVerificationTokens EmailVerificationToken[]
  addresses               Address[]

  // Indexes
  @@index([role])
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([userId])
  @@index([expiresAt])
}

model PasswordResetToken {
  id        String    @id @default(cuid())
  userId    String
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([userId])
}

model EmailVerificationToken {
  id        String    @id @default(cuid())
  userId    String
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([userId])
}

// ============================================
// Settings & Account Management Models
// ============================================

model Address {
  id            String   @id @default(cuid())
  userId        String
  label         String
  recipientName String
  phone         String
  addressLine1  String
  addressLine2  String?
  city          String
  state         String
  pincode       String
  country       String   @default("India")
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([userId])
  @@index([userId, isDefault])
}

model StoreConfig {
  id                      String   @id @default(cuid())
  storeName               String
  storeDescription        String?
  storeLogo               String?
  returnPolicy            String?
  contactEmail            String?
  contactPhone            String?
  bankAccountName         String?
  bankAccountNumber       String?
  bankIfsc                String?
  bankUpiId               String?
  paymentGatewayProvider  String?
  paymentGatewayKeyId     String?
  paymentGatewayKeySecret String?
  delhiveryApiKey         String?
  warehouseAddress        String?
  warehousePincode        String?
  defaultPackageWeight    Decimal? @db.Decimal(10, 2)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}
