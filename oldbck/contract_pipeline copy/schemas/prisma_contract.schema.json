{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "prisma_contract.schema.json",
  "type": "object",
  "additionalProperties": false,
  "required": ["moduleId", "contractVersion", "status", "changeType", "models"],
  "properties": {
    "moduleId": { "type": "string" },
    "contractVersion": { "type": "string", "pattern": "^v\\d+\\.\\d+\\.\\d+$" },
    "status": { "enum": ["draft", "agreed", "frozen"] },
    "changeType": { "enum": ["none", "non_breaking", "breaking"] },
    "models": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["model", "fields"],
        "properties": {
          "model": { "type": "string", "pattern": "^[A-Z][A-Za-z0-9_]*$" },
          "fields": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["name", "type", "isOptional", "isList", "attributes", "sourceRefs"],
              "properties": {
                "name": { "type": "string" },
                "type": { "type": "string" },
                "isOptional": { "type": "boolean" },
                "isList": { "type": "boolean" },
                "attributes": { "type": "array", "items": { "type": "string" } },
                "sourceRefs": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "string",
                    "pattern": "^(zod://|openapi://|fe://).+"
                  }
                }
              }
            }
          },
          "indexes": { "type": "array", "items": { "type": "string" } },
          "uniques": { "type": "array", "items": { "type": "string" } },
          "relations": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["name", "kind", "target", "fkFields", "references"],
              "properties": {
                "name": { "type": "string" },
                "kind": { "enum": ["oneToOne", "oneToMany", "manyToOne", "manyToMany"] },
                "target": { "type": "string" },
                "fkFields": { "type": "array", "items": { "type": "string" } },
                "references": { "type": "array", "items": { "type": "string" } }
              }
            }
          }
        }
      }
    },
    "enumDefs": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "values"],
        "properties": {
          "name": { "type": "string" },
          "values": { "type": "array", "minItems": 1, "items": { "type": "string" } }
        }
      }
    }
  }
}